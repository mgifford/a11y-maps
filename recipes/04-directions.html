<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe 04: Accessible Directions</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        @media (max-width: 600px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .map-container {
            height: 500px;
            border: 2px solid #ccc;
            border-radius: 4px;
        }

        .directions-list {
            list-style: none;
            padding: 0;
            margin: 0;
            height: 500px;
            overflow-y: auto;
            border: 1px solid #eee;
        }

        .direction-step {
            border-bottom: 1px solid #eee;
        }

        .step-btn {
            width: 100%;
            text-align: left;
            background: none;
            border: none;
            padding: 1rem;
            font: inherit;
            cursor: pointer;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .step-btn:hover {
            background: #f5f5f5;
        }

        .step-btn:focus {
            outline: 3px solid #005fcc;
            outline-offset: -3px;
            background: #eef;
        }

        .step-number {
            background: #005fcc;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        /* Highlight active step */
        .step-btn[aria-current="true"] {
            background: #e6f0ff;
            border-left: 5px solid #005fcc;
        }

        /* Ensure map focus visibility */
        .leaflet-container:focus {
            outline: 3px solid #005fcc;
            outline-offset: 2px;
        }
    </style>
</head>

<body>

    <main>
        <nav>
            <a href="../index.html">‚Üê Back to Menu</a>
        </nav>

        <h1>Recipe 04: Accessible Directions</h1>
        <p>
            <strong>The "Blind Spot" of Maps:</strong> Visual lines on a map are useless to blind users.
            We must provide a <strong>text-based alternative</strong> for every route.
        </p>

        <div class="layout">
            <!-- Text Directions (Primary for Screen Readers) -->
            <section aria-labelledby="directions-heading">
                <h2 id="directions-heading" class="visually-hidden">Walking Directions</h2>
                <ul id="directions-list" class="directions-list">
                    <!-- JS Populated -->
                </ul>
            </section>

            <!-- Visual Map -->
            <section aria-labelledby="map-heading">
                <h2 id="map-heading" class="visually-hidden">Map Route</h2>
                <figure>
                    <div id="map" class="map-container" role="application"
                        aria-label="Map showing walking route from South Bank to Somerset House" tabindex="0"></div>
                    <figcaption class="visually-hidden">Map showing a 3-step walking route across Waterloo Bridge.
                    </figcaption>
                </figure>
            </section>
        </div>

        <section style="margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;">
            <h2>Accessibility Features</h2>
            <ul>
                <li><strong>Text-First Design:</strong> The route is primarily presented as a list of text instructions.
                    The map serves as a visual aid, not the only source of truth.</li>
                <li><strong>Interactive Sync:</strong> Clicking a step zooms the map to that specific valid segment,
                    helping users with cognitive disabilities focus on one part of the journey at a time.</li>
                <li><strong>Focus Management:</strong> We maintain focus on the list while updating the map, preventing
                    disorienting context switches.</li>
            </ul>

            <h2>Try This</h2>
            <ol>
                <li><strong>Keyboard Navigation:</strong> Tab through the direction steps. Press <code>Enter</code> to
                    "focus" on a step.</li>
                <li>Observe how the map zooms to show just that segment of the walk.</li>
            </ol>
        </section>
    </main>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // 1. Data: The Route (Strictly follows sidewalks/bridge)
        const routeData = [
            {
                id: 1,
                instruction: "Start at Southbank Centre (Upper Ground). Head towards the bridge ramp.",
                distance: "120m",
                segment: [[51.5075, -0.1155], [51.5081, -0.1165]]
            },
            {
                id: 2,
                instruction: "Cross Waterloo Bridge (Pedestrian Walkway).",
                distance: "350m",
                segment: [[51.5081, -0.1165], [51.5095, -0.1175], [51.5108, -0.1185]]
            },
            {
                id: 3,
                instruction: "Cross the Strand intersection to enter Somerset House.",
                distance: "100m",
                segment: [[51.5108, -0.1185], [51.5112, -0.1190], [51.5110, -0.1171]]
            }
        ];

        // 2. Initialize Map
        const map = L.map('map').setView([51.509, -0.117], 15);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // 3. Draw Full Route (Visual Context)
        const fullPath = [
            [51.5075, -0.1155],
            [51.5081, -0.1165],
            [51.5095, -0.1175],
            [51.5108, -0.1185],
            [51.5112, -0.1190],
            [51.5110, -0.1171]
        ];
        // Background line (inactive)
        L.polyline(fullPath, { color: '#999', weight: 4, dashArray: '5, 10' }).addTo(map);

        // We will keep track of active highlight layers
        let activeLayer = null;

        // 4. Render Layout
        const listEl = document.getElementById('directions-list');

        routeData.forEach((step, index) => {
            const li = document.createElement('li');
            li.className = 'direction-step';

            const btn = document.createElement('button');
            btn.className = 'step-btn';
            btn.innerHTML = `
                <span class="step-number">${index + 1}</span>
                <div>
                    <div>${step.instruction}</div>
                    <small style="color: #666;">${step.distance}</small>
                </div>
            `;

            // Interaction
            btn.addEventListener('click', () => activateStep(step, btn));

            li.appendChild(btn);
            listEl.appendChild(li);
        });

        // 5. Activation Logic
        function activateStep(step, btnElement) {
            // Update List UI
            document.querySelectorAll('.step-btn').forEach(b => b.removeAttribute('aria-current'));
            btnElement.setAttribute('aria-current', 'true');

            // Update Map UI
            if (activeLayer) {
                map.removeLayer(activeLayer);
            }

            // Draw the active segment active/bold
            activeLayer = L.polyline(step.segment, { color: '#005fcc', weight: 6 }).addTo(map);

            // Zoom to fit segment with padding
            map.fitBounds(activeLayer.getBounds(), { padding: [50, 50], maxZoom: 17 });
        }
    </script>
</body>

</html>